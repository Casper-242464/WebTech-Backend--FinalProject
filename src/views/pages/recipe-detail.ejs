<%- include("../partials/header", { title }) %>
<section class="glass-panel p-4 mb-4">
  <% if (recipe.imageUrl) { %>
    <img src="<%= recipe.imageUrl %>" alt="<%= recipe.title %>" class="mb-4" style="width: 100%; max-height: 400px; object-fit: cover; border-radius: 8px;">
  <% } %>
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
    <div>
      <h1 class="section-title"><%= recipe.title %></h1>
      <p class="muted">By <%= recipe.author?.username || "Unknown" %></p>
      <p class="muted">Category: <%= recipe.category?.name || "Uncategorized" %></p>
    </div>
    <div class="d-flex align-items-center gap-3">
      <div class="pill"><%= recipe.cookTimeMinutes %> min | <%= recipe.calories %> cal</div>
      <% if (user && (user._id.toString() === recipe.author?._id?.toString() || user.role === 'admin')) { %>
        <button class="btn btn-danger btn-sm" onclick="deleteRecipe('<%= recipe._id %>')">Delete</button>
      <% } %>
    </div>
  </div>
  <p class="mt-3"><%= recipe.description || "No description provided." %></p>
</section>

<section class="glass-panel p-4">
  <h2 class="section-title">Ingredients</h2>
  <ul class="ingredient-list">
    <% recipe.ingredients.forEach((item) => { %>
      <li><%= item %></li>
    <% }); %>
  </ul>
</section>

<script>
function deleteRecipe(recipeId) {
  if (!confirm('Are you sure you want to delete this recipe? This action cannot be undone.')) {
    return;
  }
  
  fetch(`/recipes/${recipeId}`, {
    method: 'DELETE',
    credentials: 'same-origin'
  })
  .then(response => {
    if (response.ok) {
      alert('Recipe deleted successfully');
      window.location.href = '/profile';
    } else {
      return response.json().then(data => {
        throw new Error(data.message || 'Failed to delete recipe');
      });
    }
  })
  .catch(error => {
    alert('Error: ' + error.message);
  });
}
</script>
<%- include("../partials/footer") %>
